{template 'common/header'}
<title>小店设置</title>
<script src="../addons/ewei_shop/static/js/dist/ajaxfileupload.js" type="text/javascript"></script>
<style type="text/css">
    body {margin:0px; background:#efefef; font-family:'微软雅黑'; -moz-appearance:none;}
    a {text-decoration:none;}
    .myshop_topbar {height:40px; width:94%; padding:0px 3%; background:#f9f9f9; border-bottom:1px solid #e8e8e8; font-size:16px; line-height:40px; text-align:center; color:#666;}
    .myshop_topbar a {height:40px; width:15px; display:block; float:left; outline:0px; color:#999; font-size:24px;}
    .myshop_addnav {height:44px; width:94%; padding:0 3%; border-bottom:1px solid #f0f0f0; border-top:1px solid #f0f0f0; margin-top:14px; line-height:42px; color:#666; background:#fff;}
    .myshop_addnav {height:40px; width:94%; padding:0 3%; border-bottom:1px solid #f0f0f0; border-top:1px solid #f0f0f0; margin-top:14px; line-height:40px; color:#666; }
.myshop_main {height:auto;width:100%;/* border-bottom:1px solid #f0f0f0; border-top:1px solid #f0f0f0;  */margin-top:8px; /* background:#fff; */}
.myshop_main .line {height:44px; width:100%; border-bottom:1px solid #f0f0f0; line-height:44px;background:#fff;padding-left:13px;font-size:14px;box-sizing: border-box;}

.myshop_main .line .label { float:left;width:70px;}
.myshop_main .line .info { float:right; width:100%; margin-left:-75px;text-align: right;overflow:hidden;height:44px;}
.myshop_main .line .info .inner { color:#666;margin-left:75px;}

.myshop_main .line1 {height:80px; width:100%; border-bottom:1px solid #f0f0f0; line-height:80px;margin-top: 8px;background:#fff;padding-left:13px;font-size:14px;box-sizing: border-box;}
.myshop_main .line1 .label { float:left;width:70px;}
.myshop_main .line1 .info { float:right; width:100%; margin-left:-75px;;overflow:hidden;height:80px;}
.myshop_main .line1 .info .inner { color:#666;margin-left:75px;padding-top:10px;}
.myshop_main .line1 .info .inner .plus { float:left;width:60px;height:60px;border:1px dashed #979797; color:#efefef;font-size:45px;line-height:55px;text-align:center;}
.myshop_main .line1 .info .inner .plus1 { float:left;width:170px;height:60px;/* border:1px solid #efefef; color:#efefef; */font-size:45px;line-height:55px;text-align:center;}

.myshop_main .line1 .info .inner .preview0 { position:absolute; width:60px;height:60px;z-index:2;}
.myshop_main .line1 .info .inner .preview1 { position:absolute; width:170px;height:60px;z-index:2;border:1px dashed #979797;}

.myshop_main .line1 .info .inner .preview0 img,.myshop_main .line1 .info .inner .preview1 img { width:100%;height:100%;border:none;}

.myshop_main .line input {float:left; height:44px; width:100%; padding:0px; margin:0px; border:0px; outline:none; font-size:16px; color:#666;padding-left:5px;}
.myshop_main .line select  {float:left; border:none;height:25px;width:100%;color:#666;font-size:16px;margin-top:10px;}
.myshop_sub1 {height:35px; width:94%; margin:14px auto; background:#F4D500; border-radius:4px; text-align:center; font-size:16px; line-height:35px; color:#222121;border:1px solid #222121;}
.myshop_sub2 {height:44px; width:94%; margin:14px 3% 0px; background:#ddd; border-radius:4px; text-align:center; font-size:18px; line-height:35px; color:#222121; border:1px solid #222121;}

.myshop_main .line2 {width:100%;  line-height:25px; color:#666;overflow:hidden; font-size:13px;word-break: break-all;}

textarea {height:60px;line-height:22px; width:100%;padding:5px;font-size:13px; background:#fff; padding-left:2%; border:1px solid #e9e9e9; margin:14px 0px 0; -webkit-appearance: none;} 
.addMyLine{margin-top: 8px;}
.addmorePic{position:absolute;z-index:1;width:42px;height:42px;top:50%;left:50%;transform: translate(-50%,-50%);-webkit-transform: translate(-50%,-50%);background:url('../addons/ewei_shop/template/mobile/default/static/images/add-more-btn.png') no-repeat center center; background-size:contain;z-index:1;}
  
</style>
<div id='container'></div>

<script id='tpl_main' type='text/html'>
  <div class="myshop_topbar"><a href="javascript:;" onclick="history.back()"><i class="fa fa-angle-left"></i></a>
            小店设置
 </div>
 <div class="myshop_main" >
     
     <input type="hidden" id="img0" />
     <input type="hidden" id="img1" />
        <div class="line"><div class="label">小店名称：</div><div class="info"><div class="inner"><input type="text" id="shopname" value="<%shop.name%>"/></div></div></div>
        <div class="line1"><div class="label">小店头像：</div><div class="info"><div class="inner">
                    <div class="plus" style="position:relative;">
                        <input type="file" data-tag="0" name='imgFile0' id='imgFile0' style="position:absolute;left:0;z-index:3;width:60px;height:60px;-webkit-tap-highlight-color: transparent;filter:alpha(Opacity=0); opacity: 0;" />
                        <i class="addmorePic"  style=""></i>
                        <div id="preview0" class="preview0">
                            <%if shop.logo!=''%><img src='<%shop.logo%>'/><%/if%>
                        </div>
                    </div>
                    
                </div></div></div>
        <div class="line1"><div class="label">小店店招：</div><div class="info"><div class="inner">
                     <div class="plus1" style="position:relative;">
                        <input type="file" data-tag="1" name='imgFile1' id='imgFile1' style="position:absolute;left:0;z-index:3;width:100%;height:60px;-webkit-tap-highlight-color: transparent;filter:alpha(Opacity=0); opacity: 0;" />
                        <i class="addmorePic"  style=""></i>
                        <div id="preview1" class="preview1">
                              <%if shop.img!=''%><img src='<%shop.img%>' /><%/if%>
                          <!--    <img src=''> -->
                        </div>
                    </div>
                    
                </div></div></div>
<!--         <div class="line2"><textarea id="desc" placeholder="小店简介,分享你的小店"><%shop.desc%></textarea></div> -->
        
        <div class="line addMyLine">
            <div class="label">小店标语：</div>
            <div class="info">
                <div class="inner">
                    <input type="text" id="desc" placeholder='<%shop.desc%>'>
                </div>
            </div>
        </div>


    </div>
    <div class="myshop_sub1" id='myshop_submit'>确认</div>
</script>
 <script id="tpl_img" type="text/html">
     <img src='<%url%>' tag="<%tag%>" img='<%filename%>'/>
</script>

<script language="javascript">
    
    require(['tpl', 'core'], function(tpl, core) {
       
           core.pjson('commission/myshop',{op:'set'},function(json){
                
                  
                         $('#container').html(  tpl('tpl_main',json.result) );    
               
                      
                            $('#myshop_submit').click(function(){
                               if($(this).attr('saving')=='1'){
                                   return;
                               }
                               
                                $(this).html('正在处理...').attr('saving',1);
                                var shopdata = {
                                        name: $('#shopname').val(),
                                        desc: $('#desc').val()
                                }
                                if(!$('#img0').isEmpty()){
                                    shopdata.logo = $('#img0').val();
                                }
                                if(!$('#img1').isEmpty()){
                                    shopdata.img = $('#img1').val();
                                }
                                    
                                core.pjson('commission/myshop',{
                                    op:'set',
                                    shopdata:shopdata
                                 },function(postjson){
                                     if(postjson.status==1){
                                         history.back();
                                     }
                                     else{
                                         $(this).html('确认').removeAttr('saving');
                                         core.tip.show('操作失败');
                                     }
                                },true,true);

                           });
                           
                            //上传图片
            $('input[type=file]').change(function() {

                core.loading('正在上传');
                
                var tag= $(this).data('tag');
               
                $.ajaxFileUpload({
                    url: core.getUrl('util/uploader'),
                    data: {file: "imgFile" + tag},
                    secureuri: false, //异步
                    fileElementId: 'imgFile'+ tag, //上传控件ID
                    dataType: 'json', //返回的数据信息格式
                    success: function(res, status) {
                        core.removeLoading();
                        var obj = $(tpl('tpl_img', res));
                        $('.preview' + tag).html(obj);
                        $('#img' + tag).val( res.filename );
                    }, error: function(data, status, e) {
                        core.removeLoading();
                        core.tip.show('上传失败!');
                    }
                });
            });
                   
           },true);
      
    })
</script>
{template 'common/footer'}